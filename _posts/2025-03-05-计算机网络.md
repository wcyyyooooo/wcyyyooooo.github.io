---
layout: post
title:  "计算机网络（一）"
categories: "408"
---
计算机网络部分主要参考谢希仁老师的《计算机网络》第七版（也会参考一下第八版补充一些没有的知识）。
## 第一章 概述

### 交换方式
* 电路交换：交换之前需要简历连接，在通信中一直占用物理资源。流程为建立连接->通信->释放连接，但是信道利用率较低。
* 分组交换：采用存储转发的形式，把大的报文分为小的数据段。给每个数据段首部构成了一个分组，每个分组可以独立选择路径进行传输。
* 报文交换：就是每次都把整个报文转发出去，这样会增加接受和转发的时延，分组交换是类似于流水线式的，时延比较小。
![alt text](/asset/images/image3.png)
如果要连续传送大量数据，传送时间远大于建立时延的时间，电路交换性能更好。如果是突发性的传送，分组/报文交换不需要建立连接，信道利用率较高。由于分组交换长度远小于报文交换，所以分组交换时延较小。

### 计算机网络性能指标
* 速率：网络中的速率是数据的传送速率，也叫比特率（其中$k=10^3$ ）。
* 带宽：网络中的带宽表示某信道的最高数据传送速率，单位为bit/s。
* 吞吐量：表示单位时间实际上通过某信道的数据量，还可以使用每秒传送的字节数和帧数来确定。
* 时延：数据一段到另一端所需要的时间。
    * 发送时延：发送时延 = 数据帧长度 / 发送速率
    * 传播时延：传播时延 = 信道长度 / 电磁波在信道的传播速率
    * 处理时延
    * 排队时延：在路由器中输入队列排队的时间
* 时延带宽积：时延带宽积 = 传播时延 * 带宽
![alt text](/asset/images/image4.png)
* 往返时间：RTT指的是在信道传播的往返时间，发送时间是在网络适配器中的时延。

### 网络协议构成要素
* 语法：即数据与控制信息的结构和形式。
* 语义：即需要完成何种控制信息，完成何种动作以及做出何种响应。
* 同步：事情实现顺序的详细说明

## 第二章 物理层
物理层基本概念：物理层考虑的是怎样才能在连接的各种计算机媒体中传输比特流。屏蔽掉传输媒体和通信方式的差异，使数据链路层感受不到这些差异。
可以将物理层的主要任务描述为确定与传输媒体的接口有关的一些特性：
* 机械特性 指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。
* 电气特性 指明在接口电缆的各条线上出现的电压的范围。
* 功能特性 指明某条线上出现的某一电平的电压的意义。
* 过程特性 指明对于不同功能的各种可能事件的出现顺序。

### 数据通信的基础知识
![alt text](/asset/images/image5.png)
其中模拟信号为连续值，数字信号为离散值。

### 常用编码方式
何为编码，就是转换后仍然是数字信号
![alt text](/asset/images/image6.png)
* 不归零编码（NRZ），高电平表示1，低电平表示0，需要时钟线来进行同步。
* 归零编码（RZ），在每个码元中都跳变回零电平，提供了自同步机制。
* 反向非归零编码（NRZI），跳变表示0，不跳变表示1。
* 曼彻斯特编码，向上表示0向下表示1，或者反向定义。
* 差分曼彻斯特编码，看当前码元前半段和上一个码元后半段，跳变表示0，不变表示1（跟NRZI可以一样记一下，跳变表示0，不跳变表示1）
### 常用调制方式
![alt text](/asset/images/image7.png)

### 信道极限容量

* 奈氏准则：在理想低通信道（没有噪声，带宽有限），为了避免码间串扰，极限码元传送速率是2W，（W为信道带宽）。极限数据传送速率为$2Wlog_{2}V$。（单位为b/s，V表示不同的码元数目）
* 香农公式：带宽受限且有高斯噪声干扰的信道极限数据传输速率为$C = Wlog_{2}(1 + S / N) $（单位b/s），信噪比 = $10log_{2}(S / N)$ ( 单位DB ) 。

香农公式告诉我们，信道的带宽越大或者信噪比越大，极限数据传输速率越大。
### 传输介质
* 双绞线：模拟传输和数字传输都可使用双绞线，通信距离一般为几千米到数十千米。双绞线的带宽取决于铜线的粗细和传输的距离。距离太远时，对于模拟传输，要用放大器放大衰减的信号；对于数字传输，要用中继器来对失真的信号进行整形。
* 同轴电缆：因为外导体屏蔽层的作用，所以同轴电缆具有良好的抗干扰特性而被广泛用于传输较高速率的数据。
* 光纤：分为单模光纤，多模光纤（利用光的全反射），光纤有如下特点1，传输损耗小，中继距离长，对远距离传输特别经济。2，抗雷电和电磁干扰性能好，在有大电流脉冲干扰的环境下这尤为重要。3，无串音干扰，保密性好，不易被窃听或截取数据。4，体积小，重量轻，在现有电缆管道已拥塞不堪的情况下这特别有利。

### 信道复用
* 频分复用：给用户分配一个频带，用户始终占有这个频带（所有用户在同一时间占用不同的频带资源）
* 时分复用：顾名思义就是给每个用户分配不同的时间片（所有用户在不同的时间使用相同的频带资源）。时分复用有利于数字信号的传输，但是有时候当前用户可能不发送数据，而其他用户要发送数据，这就造成了信道的浪费。
    * STDM（统计时分复用），每次遍历用户，如果有数据要发送就加入缓存，没有就跳过去，每当一个帧满了就发送出去。一个帧对应多个时隙，时隙数往往小于连接在集中器上的用户数。
* 波分复用：光的频分复用
* 码分复用（CDM）：每个用户使用不同的码型，因此每个用户之间不会造成干扰。在CDMA中，每个bit时间划分为m个间隙即为码片。例如给S站的码片序列为00011011，S站发送比特1时就发送00011011，发送0时则取反，发送11100100，为了方便书写我们通常将0写成-1，则S站的码片序列为（-1，-1，-1，1，1，-1，1，1）。
    * 对于非S站的任意T站，向量S和T的内积必为0。
    * 向量T为(-1，-1，1，-1，1，1，1，-1)，S站想要发送向量1，T站要发送向量0，最后发送到信道的数据为$ S + \overline{T}$  = (0，0，-2，2，0，-2，0，2)。对于这个向量，把它和向量S做内积之后除8，可得1，可知发送的为比特1，与T做内积为-1，可得发送的为比特0。

## 第三章 数据链路层
数据链路层的主要任务是实现帧在一段链路上或一个网络中进行传输。数据链路层协议有多种，但有三个基本问题则是共同的，即封装成帧、透明传输和差错检测。
* 封装成帧：主要功能就是帧定界，接收端在比特流中识别一个帧的开始和结束，发送端给上一层传下来的IP数据报添加首部和尾部。每一种数据链路层协议都规定了最大数据传送单元，即IP数据报的最大长度（因为帧长度越长出错概率越大，重传的代价更大）。
* 透明传输：透明传输是指不论所传的数据是什么样的比特组合，都能够按原样无差错地在这个数据链路上传输。
* 差错检测：因为信道噪声等原因，帧在传输过程中可能会出现错误，这些错误分为位错和帧错。
    * 可靠传输：可靠传输指得是发送端发送什么，接收端就接受什么。
    * 位错：帧中某些位出现差错，通常采用循环冗余检验(CRC)来发现位错。
        * CRC:例如待传的数据为M = 101001，生成多项式为$P = x ^{3} + x^{2} + 1$，可以写成1101，冗余码为3位（对于最高次项为n+1的生成多项式，冗余码为n位）。冗余码的求法就是用1101除101001，所得的余数即为CRC。对于这个例子来说余数为001，发送出的帧为101001001。接收端如何检验呢，只要把受到的帧除1101，如果余数为0，则结果正确。
    * 帧错：帧丢失、帧重复或帧失序等错误，它们都属于传输差错。
        * 对于通信质量不好的无线传输网络，数据链路层使用确认和重传机制来给上层提供可靠传输服务。
        * 对于通信质量良好的有线传输网络，无需使用确认和重传机制，可靠服务来依靠上层的协议来完成。

### PPP协议
PPP协议是现在流行的点对点链路协议主要有以下两种应用。
* 用户通常都要连接到某个ISP才能接入互联网，PPP协议就是用户计算机与ISP通信时所用的数据链路层协议；
* 广泛用于广域网路由器之间的专用线路。

PPP协议有三个组成部分：
* 一个链路控制协议(LCP)。用来建立、配置、测试数据链路连接，以及协商一些选项。
* 一套网络控制协议(NCP)。PPP协议允许采用多种网络层协议，每个不同的网络层协议
要用一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。
* 一种将IP数据报封装到串行链路的方法。IP数据报在PPP帧中就是其信息部分，这个信息部分的长度受最大传送单元(MTU)限制。

PPP帧格式如下：
![alt text](/asset/images/image8.png)
* 首部和尾部都有一个F字段，定为 0x7E(01111110)，标记帧的开始和结束
    * 当PPP使用异步传输时，采用字节填充法，使用的转义字符是0x7D(01111101) 。
    * 当PPP使用同步传输时，采用零比特填充法来实现透明传输。
* 协议段，占2字节，它表示信息段运载的是什么种类的分组。若为 0x0021 ,则
信息字段是IP数据报。
* 信息部分，长度是0-1500字节
* FCS占两个字节，使用CRC校验

PPP协议特点：
* PPP不使用序号和确认机制，只保证无差错接收(CRC检验)，因此是不可靠服务。
* PPP只支持全双工的点对点链路，不支持多点线路。
* PPP的两端可以运行不同的网络层协议，但仍可使用同一个PPP进行通信。
* PPP是面向字节的，所有PPP帧的长度都是整数个字节。

### 网络适配器
功能：
* 数据转换：网络适配器的主要功能之一是将计算机生成的数字信号转换为可以在网络上传输的电信号、光信号或无线信号，反之亦然。例如，在以太网中，它将计算机的数字数据转换为适合在双绞线上传输的电信号。
* 数据封装与解封：在发送数据时，网络适配器会将数据封装成适合网络传输的帧格式，包括添加源和目的MAC地址、错误检测码等；在接收数据时，则会对这些帧进行解封，提取出原始数据并传递给计算机。
* 介质访问控制：网络适配器负责控制对网络传输介质（如同轴电缆、双绞线、光纤等）的访问。在共享介质的网络中，它会遵循特定的介质访问控制协议，如CSMA/CD（载波监听多路访问/冲突检测），以避免数据冲突。
* IP地址绑定：网络适配器可以绑定多个IP地址，允许一台计算机同时具有多个网络身份，从而能够访问不同的网络服务或在多个网络之间进行通信。

### CSMA/CD
CSMA/CD意思是载波监听多点接入/碰撞检测。
* 多点接入：网络为总线型网络，多个计算机连接在一根总线上。
* 载波监听：不管在发送前还是发送后不停地检测信道。
* 碰撞检测：在发送过程中检测信道，如果发生碰撞，适配器会检测到电压变化。

为什么检测到空闲在发送，仍会产生碰撞？因为从A到B发送是会产生时延的。设r为单程传播时延，A和B两站都知道发生碰撞的最长时间为2 * r。意味着只要2 * r时间内没有发生碰撞，之后不再会发生碰撞。这也意味着，需要设置一个最短的帧长，如果小于这个最短帧长，发送方就不会知道发生了碰撞，最短帧长的计算公式为$2 * r * v $（v为发送速率）。
![alt text](/asset/images/image9.png)

二进制退避算法来确定重传的时间，设争用期为$ 2 * r$
* $ k = min(重传次数， 10)$，每次从$[0, 2 ^ {k} - 1]$中选则一个数x, 退避时间为 $ x * 2 * r$。
* 重传次数至多为16次，如果仍不能成功则向上层汇报。

以太网规定了最短帧间间隔为9.6$\mu$s，即96比特的时间。

**CSMA/CD操作流程**：
* 准备发送：适配器从网络层得到一个分组，加入首部和尾部形成一个以太网帧，加入发送缓存。
* 监听信道：不断监听信道，如果信道变为空闲，且在9.6$\mu$s内一直空闲发送该帧。
* 发送过程中仍然监听信道，如果争用期没有碰撞则发送成功，否则执行二进制退避算法，退避x * 争用期的时间之后再发送。

### MAC子层
在局域网中硬件地址又称物理地址和MAC地址，固化在适配器的rom中。
MAC地址长为6字节（48位）。“发往本站的帧”包括以下三种帧：
* 单播帧（一对一），即收到的帧的目的地址与本站的MAC地址相同。
* 广播帧（一对全体），即发送给本局域网上所有站点的（全1地址）。
* 多播帧（一对多），即发送给本局域网上一部分站点的帧。

MAC帧格式：
![alt text](/asset/images/image10.png)
* 类型：指出数据字段中的数据应交给哪个上层协议处理，如网络层的IP协议
* 数据：至少为46字节，因为MAC帧最小长度为64字节。如果进行填充，上层协议例如IP协议根据总长度字段可知道填充了几个字节，最后去掉这些无用的字节。
* FCS：使用CRC校验。
* 在帧前面插入的8字节前导码分为两个字段：第一个字段是7字节的前同步码，用来实现MAC帧的比特同步；第二个字段是1字节的帧开始定界符，表示后面的信息就是MAC帧
### VLAN
一个以太网是一个广播域，当一个以太网中包含的计算机太多时，可能会导致广播风暴。故可以采用VLAN技术，把这个广播域划分成与位置无关的较小的广播域。
VLAN在以太网帧中插入一个四个字节的VLAN标记，称为802.1Q帧。插入VLAN标记之后FCS需要重新计算。
![alt text](/asset/images/image11.png)
VLAN标记长度为四个字节：
* 前两个字节是VLAN标记（0x8100），检测到VLAN标记就可以知道该帧为802.1Q帧。
* 后两个字节，前三位为用户优先级，第四位为用户规范格式标记，后12位为VLAN标识符VID，最多有4096个VLAN。

802.1Q帧只会在不同局域网之间传播，也就是不同的交换机之间。同一个交换机内部传播的仍然是普通的以太网帧。

### 高速以太网
* 100BaseT以太网，保持最短帧长不变，缩小争用期长度和最小帧间间隔变为5.12$\mu$s和0.96$\mu s$。可以在全双工和半双工的情况下工作，半双工使用CSMA/CD，传输介质为双绞线。
* 吉比特以太网：可以在全双工和半双工的情况下工作，半双工使用CSMA/CD，传输介质为双绞线或光纤。
* 10吉比特以太网：均保持以太网帧格式，但是只能全双工不使用CSMA/CD，传输介质为双绞线或者光纤。

其中100BaseT中的T表示双绞线，F表示光纤。
